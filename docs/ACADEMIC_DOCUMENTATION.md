# 사주명리학 계산 시스템 학술 문서

## 목차
1. [사주명리학 이론적 배경](#1-사주명리학-이론적-배경)
2. [간지(干支) 시스템](#2-간지干支-시스템)
3. [오행(五行) 이론](#3-오행五行-이론)
4. [사주 팔자 계산](#4-사주-팔자-계산)
5. [십성(十神) 계산 논리](#5-십성十神-계산-논리)
6. [지장간(支藏干) 이론](#6-지장간支藏干-이론)
7. [대운(大運) 계산 공식](#7-대운大運-계산-공식)
8. [시간 보정 체계](#8-시간-보정-체계)

---

## 1. 사주명리학 이론적 배경

### 1.1 사주(四柱)의 정의
사주(四柱)는 개인의 출생 시점을 년(年), 월(月), 일(日), 시(時) 네 개의 기둥으로 나타낸 것으로, 각 기둥은 천간(天干)과 지지(地支)의 조합으로 구성되어 총 8개의 글자를 형성한다. 이를 팔자(八字)라 한다.

**구성 요소:**
```
년주(年柱) = 년간(年干) + 년지(年支)
월주(月柱) = 월간(月干) + 월지(月支)
일주(日柱) = 일간(日干) + 일지(日支)
시주(時柱) = 시간(時干) + 시지(時支)
```

### 1.2 이론적 기반
사주명리학은 음양오행설(陰陽五行說)을 바탕으로 하며, 천체의 운행과 시간의 흐름이 인간의 운명에 영향을 미친다는 자연철학적 관점에서 출발한다.

---

## 2. 간지(干支) 시스템

### 2.1 천간(天干)
천간은 10개의 요소로 구성되며, 각각 음양과 오행의 속성을 가진다.

| 천간 | 음양 | 오행 | 설명 |
|------|------|------|------|
| 甲 (갑) | 양(陽) | 목(木) | 큰 나무, 양목 |
| 乙 (을) | 음(陰) | 목(木) | 작은 나무, 음목 |
| 丙 (병) | 양(陽) | 화(火) | 태양, 양화 |
| 丁 (정) | 음(陰) | 화(火) | 촛불, 음화 |
| 戊 (무) | 양(陽) | 토(土) | 산, 양토 |
| 己 (기) | 음(陰) | 토(土) | 밭, 음토 |
| 庚 (경) | 양(陽) | 금(金) | 쇠, 양금 |
| 辛 (신) | 음(陰) | 금(金) | 보석, 음금 |
| 壬 (임) | 양(陽) | 수(水) | 바다, 양수 |
| 癸 (계) | 음(陰) | 수(水) | 이슬, 음수 |

**음양 분류 공식:**
```
양간(陽干) = {甲, 丙, 戊, 庚, 壬}
음간(陰干) = {乙, 丁, 己, 辛, 癸}
```

### 2.2 지지(地支)
지지는 12개의 요소로 구성되며, 각각 계절과 시간을 나타낸다.

| 지지 | 음양 | 오행 | 계절 | 시간 | 동물 |
|------|------|------|------|------|------|
| 子 (자) | 양 | 수 | 겨울 | 23-01시 | 쥐 |
| 丑 (축) | 음 | 토 | 겨울 | 01-03시 | 소 |
| 寅 (인) | 양 | 목 | 봄 | 03-05시 | 호랑이 |
| 卯 (묘) | 음 | 목 | 봄 | 05-07시 | 토끼 |
| 辰 (진) | 양 | 토 | 봄 | 07-09시 | 용 |
| 巳 (사) | 음 | 화 | 여름 | 09-11시 | 뱀 |
| 午 (오) | 양 | 화 | 여름 | 11-13시 | 말 |
| 未 (미) | 음 | 토 | 여름 | 13-15시 | 양 |
| 申 (신) | 양 | 금 | 가을 | 15-17시 | 원숭이 |
| 酉 (유) | 음 | 금 | 가을 | 17-19시 | 닭 |
| 戌 (술) | 양 | 토 | 가을 | 19-21시 | 개 |
| 亥 (해) | 음 | 수 | 가을→겨울 | 21-23시 | 돼지 |

### 2.3 육십갑자(六十甲子)
천간 10개와 지지 12개의 조합으로 60개의 간지 조합이 생성된다.

**생성 공식:**
```
총 조합 수 = LCM(10, 12) = 60
간지[n] = (천간[n mod 10], 지지[n mod 12])
```

---

## 3. 오행(五行) 이론

### 3.1 오행의 상생상극
오행은 목(木), 화(火), 토(土), 금(金), 수(水)의 다섯 가지 기본 요소로 구성된다.

**상생(相生) 관계:**
```
목 → 화 → 토 → 금 → 수 → 목 (순환)
木生火: 나무가 불을 낸다
火生土: 불이 타면 재(흙)가 된다
土生金: 흙에서 금속이 나온다
金生水: 금속 표면에 이슬(물)이 맺힌다
水生木: 물이 나무를 키운다
```

**상극(相剋) 관계:**
```
목 → 토 → 수 → 화 → 금 → 목 (순환)
木剋土: 나무가 흙을 뚫고 자란다
土剋水: 흙이 물을 막는다
水剋火: 물이 불을 끈다
火剋金: 불이 금속을 녹인다
金剋木: 금속이 나무를 자른다
```

### 3.2 오행 추출 함수
```typescript
function getOhaeng(character: string): string {
  const mapping = {
    // 천간
    '甲': 'wood', '乙': 'wood',
    '丙': 'fire', '丁': 'fire',
    '戊': 'earth', '己': 'earth',
    '庚': 'metal', '辛': 'metal',
    '壬': 'water', '癸': 'water',
    // 지지
    '寅': 'wood', '卯': 'wood',
    '巳': 'fire', '午': 'fire',
    '辰': 'earth', '戌': 'earth', '丑': 'earth', '未': 'earth',
    '申': 'metal', '酉': 'metal',
    '子': 'water', '亥': 'water'
  };
  return mapping[character];
}
```

---

## 4. 사주 팔자 계산

### 4.1 절기(節氣) 기반 계산
사주는 절기를 기준으로 계산되며, 양력이 아닌 태양의 위치를 기준으로 한다.

**년주 계산:** 입춘(立春, 2월 4일경)을 기준으로 한다.
```
if (출생일 < 입춘) {
  년주 = 전년도 간지
} else {
  년주 = 당년도 간지
}
```

**월주 계산:** 절기(節)를 기준으로 월이 바뀐다.
- 입춘(立春): 1월 → 인월(寅月)
- 경칩(驚蟄): 2월 → 묘월(卯月)
- 청명(清明): 3월 → 진월(辰月)
- (이하 생략)

**일주 계산:** 간지 순서대로 매일 바뀐다.

**시주 계산:** 2시간 단위로 지지가 바뀐다.

### 4.2 월간(月干) 계산 공식
월간은 년간과 월지를 기준으로 계산된다.

**오호십이법(五虎遁十二法):**
```
년간이 甲/己 → 월간 시작: 丙寅
년간이 乙/庚 → 월간 시작: 戊寅
년간이 丙/辛 → 월간 시작: 庚寅
년간이 丁/壬 → 월간 시작: 壬寅
년간이 戊/癸 → 월간 시작: 甲寅
```

### 4.3 시간(時干) 계산 공식
시간은 일간과 시지를 기준으로 계산된다.

**오서십이법(五鼠遁十二法):**
```
일간이 甲/己 → 시간 시작: 甲子
일간이 乙/庚 → 시간 시작: 丙子
일간이 丙/辛 → 시간 시작: 戊子
일간이 丁/壬 → 시간 시작: 庚子
일간이 戊/癸 → 시간 시작: 壬子
```

---

## 5. 십성(十神) 계산 논리

### 5.1 십성의 정의
십성은 일간(日干, 나)을 기준으로 다른 천간/지지와의 관계를 나타낸다.

### 5.2 십성 분류 체계

**기본 분류:**
1. **비견(比肩)**: 나와 같은 오행, 같은 음양
2. **겁재(劫財)**: 나와 같은 오행, 다른 음양
3. **식신(食神)**: 내가 생하는 오행, 같은 음양
4. **상관(傷官)**: 내가 생하는 오행, 다른 음양
5. **편재(偏財)**: 내가 극하는 오행, 같은 음양
6. **정재(正財)**: 내가 극하는 오행, 다른 음양
7. **편관(偏官)**: 나를 극하는 오행, 같은 음양
8. **정관(正官)**: 나를 극하는 오행, 다른 음양
9. **편인(偏印)**: 나를 생하는 오행, 같은 음양
10. **정인(正印)**: 나를 생하는 오행, 다른 음양

### 5.3 십성 계산 알고리즘

```typescript
function calculateSipsin(dayMaster: string, target: string): string {
  const dmElement = getOhaeng(dayMaster);
  const dmPolarity = getPolarity(dayMaster);
  const targetElement = getOhaeng(target);
  const targetPolarity = getPolarity(target);
  
  const samePolarity = (dmPolarity === targetPolarity);
  
  // 1. 같은 오행
  if (dmElement === targetElement) {
    return samePolarity ? '비견' : '겁재';
  }
  
  // 2. 내가 생하는 오행 (상생)
  if (isGenerating(dmElement, targetElement)) {
    return samePolarity ? '식신' : '상관';
  }
  
  // 3. 내가 극하는 오행 (상극)
  if (isControlling(dmElement, targetElement)) {
    return samePolarity ? '편재' : '정재';
  }
  
  // 4. 나를 극하는 오행
  if (isControlling(targetElement, dmElement)) {
    return samePolarity ? '편관' : '정관';
  }
  
  // 5. 나를 생하는 오행
  if (isGenerating(targetElement, dmElement)) {
    return samePolarity ? '편인' : '정인';
  }
}
```

**상생 판단:**
```typescript
function isGenerating(source: string, target: string): boolean {
  const cycle = {
    'wood': 'fire',
    'fire': 'earth',
    'earth': 'metal',
    'metal': 'water',
    'water': 'wood'
  };
  return cycle[source] === target;
}
```

**상극 판단:**
```typescript
function isControlling(source: string, target: string): boolean {
  const cycle = {
    'wood': 'earth',
    'earth': 'water',
    'water': 'fire',
    'fire': 'metal',
    'metal': 'wood'
  };
  return cycle[source] === target;
}
```

---

## 6. 지장간(支藏干) 이론

### 6.1 지장간의 개념
지지(地支) 안에 숨어있는 천간(天干)을 지장간(支藏干)이라 한다. 각 지지는 1~3개의 천간을 내포한다.

### 6.2 지장간 배당표

| 지지 | 지장간 | 설명 |
|------|--------|------|
| 子 | 壬, 癸 | 수 기운 (양수, 음수) |
| 丑 | 癸, 辛, 己 | 토 중 수금토 |
| 寅 | 戊, 丙, 甲 | 목 중 토화목 |
| 卯 | 甲, 乙 | 목 기운 (양목, 음목) |
| 辰 | 乙, 癸, 戊 | 토 중 목수토 |
| 巳 | 戊, 庚, 丙 | 화 중 토금화 |
| 午 | 丙, 己, 丁 | 화 중 화토화 |
| 未 | 丁, 乙, 己 | 토 중 화목토 |
| 申 | 戊, 壬, 庚 | 금 중 토수금 |
| 酉 | 庚, 辛 | 금 기운 (양금, 음금) |
| 戌 | 辛, 丁, 戊 | 토 중 금화토 |
| 亥 | 戊, 甲, 壬 | 수 중 토목수 |

### 6.3 지장간의 의미
지장간은 지지의 복합적 성질을 나타내며, 사주 해석에서 숨은 영향력을 분석하는 데 사용된다.

**적용 예:**
```typescript
function getJijanggan(ji: string): string[] {
  const mapping = {
    '子': ['壬', '癸'],
    '丑': ['癸', '辛', '己'],
    // ... (생략)
  };
  return mapping[ji] || [];
}

// 지장간의 십성 계산
jijangganTenGods = jijanggan.map(char => calculateSipsin(dayMaster, char));
```

---

## 7. 대운(大運) 계산 공식

### 7.1 대운의 개념
대운(大運)은 10년 단위의 운세 주기를 나타내며, 월주를 기준으로 순행 또는 역행한다.

### 7.2 대운 방향 결정

**양남음녀 순행, 음남양녀 역행 원칙:**

```
if ((년간이 양 && 성별이 남) || (년간이 음 && 성별이 여)) {
  대운 방향 = 순행(forward)
} else {
  대운 방향 = 역행(backward)
}
```

**논리적 근거:**
- 양(陽)은 전진, 음(陰)은 후퇴의 성질
- 남성은 양, 여성은 음의 성질
- 같은 성질은 순행, 다른 성질은 역행

### 7.3 대운수(大運數) 계산 공식

**전통 공식:**
```
대운수(세) = ⌊절기까지의 일수 / 3⌋
```

**상세 알고리즘:**

1. **절기 방향 결정:**
   - 순행: 다음 절기(節, Jie)까지 일수
   - 역행: 이전 절기까지 일수

2. **절기 목록 (節, Jie):**
   ```
   節氣 = {立春, 驚蟄, 清明, 立夏, 芒種, 小暑, 
          立秋, 白露, 寒露, 立冬, 大雪, 小寒}
   ```

3. **일수 계산:**
   ```typescript
   function calculateDaeunStartAge(
     birthDate: Date,
     direction: 'forward' | 'backward'
   ): number {
     // 1. 가장 가까운 절기 찾기
     const jieqiTable = getJieQiTable(birthDate);
     const closestJie = findClosestJie(birthDate, direction, jieqiTable);
     
     // 2. 일수 계산
     const days = calculateDaysDifference(birthDate, closestJie);
     
     // 3. 대운수 = 일수 / 3 (반올림)
     const daeunSu = Math.round(days / 3);
     
     return Math.max(1, daeunSu); // 최소 1세
   }
   ```

### 7.4 대운 간지 배열

**순행 계산:**
```
대운[n] = (월간 + n) mod 10, (월지 + n) mod 12
```

**역행 계산:**
```
대운[n] = (월간 - n + 10) mod 10, (월지 - n + 12) mod 12
```

**나이 범위:**
```
n번째 대운 시작 나이 = 대운수 + (n × 10)
n번째 대운 종료 나이 = 대운수 + (n × 10) + 9
```

**예시:**
```
대운수 = 7세, 순행
1대운: 7-16세 (월주의 다음 간지)
2대운: 17-26세 (월주의 다다음 간지)
3대운: 27-36세
...
```

### 7.5 대운 계산의 천문학적 근거

대운의 3일 = 1세 공식은 천체 운행의 주기성에 기반한다:
- 음력 1개월 ≈ 30일
- 1년 = 12개월 ≈ 360일
- 360일 / 120세(인간 수명) = 3일

---

## 8. 시간 보정 체계

### 8.1 한국 표준시 변천사

한국의 표준시는 역사적으로 여러 차례 변경되었으며, 정확한 사주 계산을 위해서는 이를 보정해야 한다.

**표준시 변경 내역:**

1. **UTC+08:30 시기**
   - 1908.04.01 ~ 1911.12.31
   - 1954.03.21 ~ 1961.08.09
   - 보정: -30분

2. **일광절약시간제 (서머타임)**
   - 1948~1960년 (여러 기간)
   - 1987~1988년 (여러 기간)
   - 보정: -60분

### 8.2 시간 보정 알고리즘

```typescript
function applyTimezoneCorrection(
  year: number, month: number, day: number,
  hour: number, minute: number
): {hour: number, minute: number} {
  let adjustment = 0; // 분 단위
  
  // UTC+08:30 보정
  if (isInUTC830Period(year, month, day)) {
    adjustment -= 30;
  }
  
  // 일광절약시간 보정
  if (isInDSTPerio(year, month, day, hour)) {
    adjustment -= 60;
  }
  
  // 시간 조정
  let totalMinutes = hour * 60 + minute + adjustment;
  
  // 날짜 경계 처리
  if (totalMinutes < 0) totalMinutes += 1440; // 전날
  if (totalMinutes >= 1440) totalMinutes -= 1440; // 다음날
  
  return {
    hour: Math.floor(totalMinutes / 60),
    minute: totalMinutes % 60
  };
}
```

### 8.3 시간 보정의 중요성

시주(時柱) 계산에서 1시간 오차는 다른 시지(時支)를 산출할 수 있으며, 이는 전체 사주 해석을 바꿀 수 있다.

**예시:**
```
원래 시간: 23:30 → 子時
보정 후: 22:30 → 亥時 (다른 시주!)
```

---

## 9. 구현 검증

### 9.1 테스트 케이스

**대운 계산 검증:**
```
입력: 1990.05.15 12:00, 남자
출력:
- 년간: 庚 (양금) → 역행 (음남)
- 대운수: 7세
- 1대운: 7-16세 壬午
- 2대운: 17-26세 癸未

입력: 2000.01.01 00:01, 남자
출력:
- 년간: 己 (음토) → 순행 (음남)
- 대운수: 8세 (前年 절기 참조)
- 1대운: 8-17세 乙亥
```

### 9.2 정확도 분석

1. **간지 계산**: lunar-javascript 라이브러리 사용 (천문 계산 기반)
2. **절기 데이터**: 실제 천체 위치 기반 계산
3. **시간 보정**: 역사적 기록에 근거한 정확한 보정

---

## 10. 참고문헌 및 출처

1. **고전 문헌**
   - 『淵海子平』(연해자평)
   - 『三命通會』(삼명통회)
   - 『滴天髓』(적천수)

2. **현대 연구**
   - 천문력 계산 알고리즘
   - 동양철학 이론서

3. **기술 참고**
   - lunar-javascript 라이브러리
   - 한국천문연구원 절기 데이터

---

## 부록: 수식 요약

### A. 음양 판별
```
isYang(干) = {甲, 丙, 戊, 庚, 壬}.contains(干)
isYang(支) = {子, 寅, 辰, 午, 申, 戌}.contains(支)
```

### B. 오행 순환
```
相生: E[i] → E[(i+1) mod 5]
相剋: E[i] → E[(i+2) mod 5]
where E = [木, 火, 土, 金, 水]
```

### C. 간지 순환
```
干支(n) = (G[n mod 10], Z[n mod 12])
where G = 천간 배열, Z = 지지 배열
```

### D. 대운 공식
```
大運數 = ⌊|D(출생일, 절기)| / 3⌋
大運[n] = 月柱 ± n × (天干1, 地支1)
나이[n] = 大運數 + 10n ~ 大運數 + 10n + 9
```

---

**문서 버전:** 1.0  
**최종 수정:** 2025-11-30  
**작성자:** Saju Calculation System Development Team
