# 대운 및 세운 산출 공식 가이드

이 문서는 프로그램에서 사용하는 대운(大運) 및 세운(歲運, 년운)의 산출 공식과 로직을 설명합니다.

---

## 1. 대운 (Grand Fortune) 산출

대운은 한 개인의 삶에서 10년 단위로 변화하는 큰 운의 흐름을 나타냅니다.

### 1.1 대운의 방향 (순행/역행)
대운이 월주(月柱)로부터 정방향(순행)으로 나아갈지, 역방향(역행)으로 나아갈지는 태어난 연도의 천간(연간)의 음양과 성별에 의해 결정됩니다.

- **순행 (Forward)**: 양남음녀 (陽男陰女)
    - 양(陽)의 해에 태어난 남성
    - 음(陰)의 해에 태어난 여성
- **역행 (Backward)**: 음남양녀 (陰男陽女)
    - 음(陰)의 해에 태어난 남성
    - 양(陽)의 해에 태어난 여성

*※ 양의 천간: 甲, 丙, 戊, 庚, 壬 / 음의 천간: 乙, 丁, 己, 辛, 癸*

### 1.2 대운수 (대운 시작 나이) 산출
대운수는 대운이 바뀌는 주기를 결정하며, 태어난 시점부터 인접한 절기(節, Jie)까지의 일수를 기준으로 계산합니다.

1. **기준 절기 찾기**:
    - **순행**: 태어난 날로부터 **다음** 절기(입춘, 경칩 등 12절기)까지의 남은 일수.
    - **역행**: 태어난 날로부터 **이전** 절기(입춘, 경칩 등 12절기)까지의 지난 일수.
2. **계산 공식**:
    - `대운수 = Math.round(간격일수 / 3)`
    - 3일을 1년으로 보며, 반올림하여 정수화합니다. (최소 1년)

### 1.3 대운 주선 (Sequence)
- 월주(月柱)를 제외한 다음(또는 이전) 간지부터 8개의 대운을 순차적으로 생성합니다.
- 각 대운은 10년간 유지됩니다.

---

## 2. 세운 (Annual Fortune) 산출

세운은 매해 바뀌는 연도별 운을 의미합니다.

### 2.1 연도별 간지 산출
- **기준점**: 태양력 기준의 **입춘(立春)**을 한 해의 시작점으로 봅니다.
- 프로그램은 `lunar-javascript` 라이브러리의 `getYearInGanZhiByLiChun()`을 사용하여 입춘 전후의 연도 간지를 정확하게 구분합니다.

### 2.2 세운의 구성
각 세운은 다음과 같은 정보를 포함합니다.
- **연도**: 해당 달력 연도
- **간지**: 해당 연도의 육십갑자 (예: 2025년 乙巳년)
- **오행 및 색상**: 천간과 지지의 오행 속성에 따른 시각적 표시
- **십성 (Ten Gods)**: 본인의 **일간(日干)**을 기준으로 해당 연도의 천간(세간)과 지지(세지)가 맺는 관계 (예: 식신, 정재 등)

---

## 3. 관련 코드 참조
- 산출 로직: `src/shared/lib/saju/SajuCalculator.ts`
- 데이터 타입: `src/entities/saju/model/types.ts`
